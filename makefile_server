cc = g++
flags = -W -g -Wno-deprecated
INC=-I/usr/local/protobuf2.4.1/include\
    -I/usr/local/sofa-pbrpc/include \

LIBS=-L/usr/local/sofa-pbrpc/lib -lsofa-pbrpc \
     -L/usr/local/snappy1.1.1/lib -lsnappy \
     -L/usr/local/protobuf2.4.1/lib -lprotobuf -lprotoc -lprotobuf-lite\
	 -ldl -lpthread -lz
	
TARGET=net_server

PROTO_SRC=netserver.proto
#OBJS=$(patsubst %.cpp,obj/%.o,$(wildcard *.cpp))
OBJS=$(patsubst %.cpp,obj/%.o,net_server.cpp)
OBJS_PB = $(patsubst %.proto,obj/%.pb.o,$(PROTO_SRC))

obj/%.o:%.cpp
	$(cc) -c $< $(flags) $(INC) -o $@
obj/%.pb.o:%.pb.cc
	$(cc) -c $< $(flags) $(INC) -o $@
%.pb.cc:%.proto
	/usr/local/protobuf2.4.1/bin/protoc -I=./ --cpp_out=./ $<
	
$(TARGET):$(OBJS_PB) $(OBJS)
	$(cc) -o $(TARGET) $(OBJS) $(OBJS_PB) $(LIBS) $(INC)


clean:
	rm -f obj/*.o
	rm -f *pb.h
	rm -f $(TARGET)
